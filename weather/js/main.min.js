/*
	TODO
		1) Get location and get in HTML
		2) Get degrees
		3) Get status
*/
console.log('Change');

var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open("get", url, true);
    xhr.responseType = "json";
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        callback(null, xhr.response);
      } else {
        callback(status);
      }
    };
    xhr.send();
};

// Get the location of the app
getJSON("http://ip-api.com/json", function(err, data){
  var lat      = document.getElementById('lat'),
      lon      = document.getElementById('lon'),
	  location = document.getElementsByClass('location'), 
      city     = location[0].getElementsByClass('city'), 
      country  = document.getElementsByClassName('country'); 

  if(err != null)
    alert("Error: " + err);
  else
  {
	  city.innerHTML    = data.city; 
      country.innerHTML = data.country
      lat.innerHTML     = data.latitude; 
      lon.innerHTML     = data.longitude;    
      
      weather_call = "http://api.openweathermap.org/data/2.5/weather?q=" + data.city + "&APPID=0979d1abe69ef38e373332494cbef5a8&units=metric";

      // Find the climate status
      getJSON( weather_call, function (err, data){

        var degree = document.getElementById('degree'),
            status = document.getElementById('status');

         if(err != null)
            console.log("Error: " + err); 
         else {
            console.log();
            degree.innerHTML  = data.main.temp;
            status.innerHTML  = data.weather[0].main;
         }

      });    
  }
});
